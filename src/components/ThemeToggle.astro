<theme-toggle class='ms-2 sm:ms-4'>
	<button
		class='relative h-7 w-7 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2'
		type='button'>
		<span class='sr-only'>Dark Theme</span>
		<svg
			viewBox='0 0 24 24'
			fill='none'
			xmlns='http://www.w3.org/2000/svg'
			aria-hidden='true'
			class='absolute start-1/2 top-1/2 h-5 w-5 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0'>
			<path
				fill-rule='evenodd'
				clip-rule='evenodd'
				d='M12 1.25C12.4142 1.25 12.75 1.58579 12.75 2L12.75 5C12.75 5.41421 12.4142 5.75 12 5.75C11.5858 5.75 11.25 5.41421 11.25 5L11.25 2C11.25 1.58579 11.5858 1.25 12 1.25ZM12 18.25C12.4142 18.25 12.75 18.5858 12.75 19V22C12.75 22.4142 12.4142 22.75 12 22.75C11.5858 22.75 11.25 22.4142 11.25 22V19C11.25 18.5858 11.5858 18.25 12 18.25ZM12 8.75C10.2051 8.75 8.75 10.2051 8.75 12C8.75 13.7949 10.2051 15.25 12 15.25C13.7949 15.25 15.25 13.7949 15.25 12C15.25 10.2051 13.7949 8.75 12 8.75ZM7.25 12C7.25 9.37665 9.37665 7.25 12 7.25C14.6234 7.25 16.75 9.37665 16.75 12C16.75 14.6234 14.6234 16.75 12 16.75C9.37665 16.75 7.25 14.6234 7.25 12ZM2 11.25C1.58579 11.25 1.25 11.5858 1.25 12C1.25 12.4142 1.58579 12.75 2 12.75L5 12.75C5.41421 12.75 5.75 12.4142 5.75 12C5.75 11.5858 5.41421 11.25 5 11.25L2 11.25ZM19 11.25C18.5858 11.25 18.25 11.5858 18.25 12C18.25 12.4142 18.5858 12.75 19 12.75H22C22.4142 12.75 22.75 12.4142 22.75 12C22.75 11.5858 22.4142 11.25 22 11.25H19ZM4.39862 4.39862C4.69152 4.10573 5.16639 4.10573 5.45929 4.39862L7.58061 6.51995C7.8735 6.81284 7.8735 7.28771 7.58061 7.58061C7.28771 7.8735 6.81284 7.8735 6.51995 7.58061L4.39863 5.45928C4.10573 5.16639 4.10573 4.69152 4.39862 4.39862ZM16.4194 16.4194C16.7123 16.1265 17.1872 16.1265 17.4801 16.4194L19.6014 18.5408C19.8943 18.8337 19.8943 19.3085 19.6014 19.6014C19.3085 19.8943 18.8337 19.8943 18.5408 19.6014L16.4194 17.4801C16.1265 17.1872 16.1265 16.7123 16.4194 16.4194ZM4.39862 18.5407C4.10573 18.8336 4.10573 19.3085 4.39862 19.6014C4.69152 19.8943 5.16639 19.8943 5.45928 19.6014L7.58061 17.4801C7.8735 17.1872 7.8735 16.7123 7.58061 16.4194C7.28771 16.1265 6.81284 16.1265 6.51995 16.4194L4.39862 18.5407ZM16.4194 6.5199C16.1265 6.81279 16.1265 7.28767 16.4194 7.58056C16.7123 7.87345 17.1872 7.87345 17.4801 7.58056L19.6014 5.45924C19.8943 5.16635 19.8943 4.69147 19.6014 4.39858C19.3085 4.10569 18.8337 4.10569 18.5408 4.39858L16.4194 6.5199Z'
				fill='#22282F'></path>
		</svg>
		<svg
			viewBox='0 0 24 24'
			fill='none'
			focusable='false'
			aria-hidden='true'
			xmlns='http://www.w3.org/2000/svg'
			class='absolute start-1/2 top-1/2 h-5 w-5 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100'>
			<path
				fill-rule='evenodd'
				clip-rule='evenodd'
				d='M11.3264 1.71835C11.4807 1.98285 11.4588 2.31462 11.2709 2.55645C10.3174 3.78389 9.75 5.32464 9.75 7.00002C9.75 11.0041 12.9959 14.25 17 14.25C18.1022 14.25 19.1449 14.0046 20.0784 13.5661C20.3558 13.4358 20.6845 13.4874 20.9087 13.6963C21.1328 13.9053 21.2073 14.2296 21.0968 14.5154C19.6868 18.1618 16.1466 20.75 12 20.75C6.61522 20.75 2.25 16.3848 2.25 11C2.25 6.10089 5.86263 2.04685 10.5694 1.35433C10.8724 1.30975 11.1721 1.45385 11.3264 1.71835ZM9.07683 3.28266C5.96346 4.46256 3.75 7.47328 3.75 11C3.75 15.5564 7.44365 19.25 12 19.25C14.8756 19.25 17.4088 17.7786 18.8857 15.5462C18.278 15.6797 17.647 15.75 17 15.75C12.1675 15.75 8.25 11.8325 8.25 7.00002C8.25 5.67143 8.54651 4.41117 9.07683 3.28266Z'
				fill='currentColor'></path>
		</svg>
	</button>
</theme-toggle>

<script>
	// Note that if you fire the theme-change event outside of this component, it will not be reflected in the button's aria-checked attribute
	import { rootInDarkMode } from "@/utils";

	class ThemeToggle extends HTMLElement {
		#controller: AbortController | undefined;

		connectedCallback() {
			const button = this.querySelector("button")!;
			// set aria role value
			button.setAttribute("role", "switch");
			button.setAttribute("aria-checked", String(rootInDarkMode()));
			// Abort signal
			const { signal } = (this.#controller = new AbortController());

			// button event
			button.addEventListener(
				"click",
				() => {
					// invert theme
					let themeChangeEvent = new CustomEvent("theme-change", {
						detail: {
							theme: rootInDarkMode() ? "light" : "dark",
						},
					});
					// dispatch event -> ThemeProvider.astro
					document.dispatchEvent(themeChangeEvent);

					// set the aria-checked attribute
					button.setAttribute("aria-checked", String(rootInDarkMode()));
				},
				{ signal }
			);
		}

		disconnectedCallback() {
			this.#controller?.abort();
		}
	}

	customElements.define("theme-toggle", ThemeToggle);
</script>
